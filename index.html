<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-store" />
<title>A TO Z Cleaning Expert Ltd. — Walkthrough & Estimator Tool (v4.1 Final)</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* ============================================================
   A TO Z CLEANING EXPERT LTD. — WALKTHROUGH & ESTIMATOR TOOL
   Version: v4.1 Final Unified (Light Mode Default)
   ============================================================ */

/* ---------- ROOT THEME ---------- */
:root {
  --primary: #004AAD;
  --accent: #00C2FF;
  --background: #F9FAFB;
  --surface: #FFFFFF;
  --text: #1E1E1E;
  --border: #E5E7EB;
  --success: #00A36C;
  --warning: #E0A500;
  --danger: #E63B3B;
}

body.dark {
  --background: #1E1E2F;
  --surface: #2B2B3C;
  --text: #F3F4F6;
  --border: #3C3C4A;
}

/* ---------- GLOBAL STYLING ---------- */
body {
  font-family: 'Poppins', sans-serif;
  background: var(--background);
  color: var(--text);
  margin: 0;
  padding: 0;
  transition: background 0.3s, color 0.3s;
}

h1, h2, h3, h4, h5 {
  margin: 0 0 10px;
  font-weight: 600;
  color: var(--primary);
}
p {
  margin: 0 0 10px;
  line-height: 1.6;
}

/* ---------- HEADER ---------- */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 25px;
  background: var(--surface);
  border-bottom: 2px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 1000;
}
.header-content {
  display: flex;
  align-items: center;
  gap: 12px;
}
.header-content img {
  height: 55px;
  width: auto;
}
.header-text h1 {
  font-size: 1.2rem;
  color: var(--primary);
}
.header-text p {
  font-size: 0.9rem;
  color: var(--text);
}
#darkToggle {
  background: none;
  border: none;
  color: var(--primary);
  font-size: 1.2rem;
  cursor: pointer;
}

/* ---------- MAIN FORM ---------- */
main {
  max-width: 1100px;
  margin: 20px auto;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 25px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
section {
  display: none;
}
section.active {
  display: block;
}

/* ---------- PROGRESS BAR ---------- */
#progressText {
  text-align: right;
  font-size: 0.9rem;
  color: var(--primary);
  margin-bottom: 8px;
}
#progressContainer {
  background: #E5E7EB;
  border-radius: 6px;
  overflow: hidden;
  margin-bottom: 25px;
}
#progressBar {
  background: var(--accent);
  height: 8px;
  width: 0%;
  transition: width 0.4s ease;
}

/* ---------- FORM INPUTS ---------- */
label {
  display: block;
  font-weight: 500;
  margin: 10px 0 5px;
}
input[type="text"],
input[type="number"],
input[type="email"],
input[type="tel"],
input[type="date"],
textarea,
select {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--surface);
  color: var(--text);
  font-size: 0.95rem;
}
textarea { resize: vertical; }

input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  outline: none;
  box-shadow: 0 0 0 3px rgba(0,194,255,0.15);
}

/* ---------- BUTTONS ---------- */
button {
  cursor: pointer;
  border: none;
  border-radius: 6px;
  padding: 10px 20px;
  font-weight: 500;
  transition: all 0.3s ease;
}

button:hover { opacity: 0.9; }

.nav-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.nav-buttons button {
  background: var(--primary);
  color: #fff;
}

.reset-btn {
  background: var(--danger);
  color: #fff;
}

.secondary-btn {
  background: #9CA3AF;
  color: #fff;
}

/* ---------- GENERATE QUOTE BUTTON ---------- */
#genQuote {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: 6px 14px;
  font-size: 0.85rem;
  font-weight: 500;
  margin-top: 10px;
  width: 100%;
  height: 34px;
  cursor: pointer;
  transition: background 0.25s ease;
}
#genQuote:hover {
  background: #00a9e5;
}


/* ---------- PHOTO GRID ---------- */
.photo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 6px;
  margin-top: 10px;
}
.photo-grid img {
  width: 100%;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
  border: 1px solid var(--border);
  cursor: pointer;
}

/* ---------- LIGHTBOX ---------- */
#photoLightbox {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
#photoLightbox.active { display: flex; }
#lightboxImg {
  max-width: 90%;
  max-height: 80%;
  border-radius: 10px;
}
#lightboxPrev, #lightboxNext {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 2rem;
  color: #fff;
  background: none;
  border: none;
  cursor: pointer;
}
#lightboxPrev { left: 30px; }
#lightboxNext { right: 30px; }
#lightboxCaption {
  position: absolute;
  bottom: 30px;
  color: #fff;
  font-size: 0.95rem;
  text-align: center;
}

/* ---------- ESTIMATOR GRID ---------- */
.calc-grid {
  display: grid;
  grid-template-columns: 1.2fr 0.8fr;
  gap: 25px;
  align-items: flex-start;
}
.calc-inputs, .calc-results {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 20px;
  background: var(--surface);
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.calc-results {
  position: sticky;
  top: 90px;
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 900px) {
  .calc-grid { grid-template-columns: 1fr; }
  .calc-results { position: static; margin-top: 20px; }
}

/* ---------- PROFIT MARGIN COLOR STATES ---------- */
.low-margin {
  color: var(--danger);
  font-weight: 600;
}
.medium-margin {
  color: var(--warning);
  font-weight: 600;
}
.high-margin {
  color: var(--success);
  font-weight: 600;
}


/* ---------- FOOTER ---------- */
footer {
  text-align: center;
  color: var(--text);
  font-size: 0.85rem;
  padding: 20px;
  margin-top: 40px;
  border-top: 1px solid var(--border);
}
footer a { color: var(--primary); text-decoration: none; }

/* ---------- GENERATE QUOTE BUTTON ---------- */
#genQuote {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: 6px 14px;
  font-size: 0.85rem;
  font-weight: 500;
  margin-top: 10px;
  width: 100%;
  height: 34px;
  cursor: pointer;
  transition: background 0.25s ease;
}
#genQuote:hover {
  background: #00a9e5;
}


</style>
</head>
<body>
<header>
  <div class="header-content">
    <img src="https://atozcleaningexpert.github.io/assessment/a-to-z-logo.png" alt="A TO Z Cleaning Expert Logo">
    <div class="header-text">
      <h1>A TO Z CLEANING EXPERT LTD.</h1>
      <p>Comprehensive Walkthrough & Estimator Tool</p>
    </div>
  </div>
  <button id="darkToggle" title="Toggle Dark Mode"><i class="fa fa-moon"></i></button>
</header>

<main>
  <!-- PROGRESS BAR -->
  <div id="progressText">Step 1 of 11</div>
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>

  <!-- STEP 1 — CLIENT & SITE INFORMATION -->
  <section id="step1" class="active">
    <h2><i class="fa fa-user"></i> Step 1 — Client & Site Information</h2>
    <p>Please fill out the client and site details to begin the walkthrough.</p>

    <label for="assessorName">Assessor Name</label>
    <input type="text" id="assessorName" placeholder="e.g., John Smith" required>

    <label for="clientName">Client / Company Name</label>
    <input type="text" id="clientName" placeholder="e.g., ABC Holdings Inc." required>

    <label for="contactPerson">Contact Person</label>
    <input type="text" id="contactPerson" placeholder="e.g., Sarah Lee" required>

    <label for="email">Email Address</label>
    <input type="email" id="email" placeholder="e.g., contact@example.com" required>

    <label for="phone">Phone Number</label>
    <input type="tel" id="phone" placeholder="e.g., +1 (613) 555-1234" required>

    <label for="address">Site Address</label>
    <textarea id="address" rows="2" placeholder="e.g., 300 Coventry Rd, Ottawa, ON K1K 4P5"></textarea>

    <label for="facilityType">Facility Type</label>
    <select id="facilityType" required>
      <option value="">Select type…</option>
      <option>Office Building</option>
      <option>Medical / Dental Clinic</option>
      <option>School / Educational</option>
      <option>Retail / Storefront</option>
      <option>Warehouse / Industrial</option>
      <option>Gym / Fitness Center</option>
      <option>Restaurant / Food Service</option>
      <option>Other</option>
    </select>

    <label for="hours">Operating Hours</label>
    <input type="text" id="hours" placeholder="e.g., 8:00 AM – 8:00 PM">

    <label for="assessmentDate">Assessment Date</label>
    <input type="date" id="assessmentDate">

    <label for="startDate">Preferred Start Date</label>
    <input type="date" id="startDate">

    <div class="nav-buttons">
      <button type="button" id="next1">Next</button>
    </div>
  </section>
  <!-- STEP 2 — FACILITY OVERVIEW -->
  <section id="step2">
    <h2><i class="fa fa-building"></i> Step 2 — Facility Overview</h2>
    <p>Provide general information about the facility to help us calculate accurate cleaning time and cost.</p>

    <label for="squareFootage">Total Square Footage</label>
    <input type="number" id="squareFootage" placeholder="e.g., 10,000" required>

    <label for="floors">Number of Floors</label>
    <input type="number" id="floors" placeholder="e.g., 3" min="1">

    <label for="frequency">Cleaning Frequency</label>
    <select id="frequency" required>
      <option value="">Select frequency…</option>
      <option value="Daily">Daily</option>
      <option value="Weekly">Weekly</option>
      <option value="Bi-Weekly">Bi-Weekly</option>
      <option value="Monthly">Monthly</option>
      <option value="One-Time">One-Time Cleaning</option>
    </select>

    <label for="flooringType">Primary Flooring Type</label>
    <select id="flooringType">
      <option value="">Select type…</option>
      <option>Tile</option>
      <option>Carpet</option>
      <option>Vinyl</option>
      <option>Concrete</option>
      <option>Mixed</option>
    </select>

    <label for="accessNotes">Access & Security Notes</label>
    <textarea id="accessNotes" rows="2" placeholder="e.g., Security badge required, alarm code, entry process..."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev2">Previous</button>
      <button type="button" id="next2">Next</button>
    </div>
  </section>

  <!-- STEP 3 — AREA-BY-AREA INSPECTION -->
  <section id="step3">
    <h2><i class="fa fa-clipboard-check"></i> Step 3 — Area-by-Area Inspection</h2>
    <p>Inspect each main area, add your notes, and upload up to five photos for documentation.</p>

    <!-- FRONT DESK -->
    <div class="inspection-area">
      <h3><i class="fa fa-receipt"></i> Front Desk / Reception</h3>
      <label for="frontDeskNotes">Inspection Notes</label>
      <textarea id="frontDeskNotes" rows="2" placeholder="e.g., Fingerprints on reception glass, dust on counter..."></textarea>

      <label for="frontDeskPhotos">Upload Photos (max 5)</label>
      <input type="file" id="frontDeskPhotos" accept="image/*" multiple>
      <div class="photo-grid" id="frontDeskPreview"></div>
    </div>

    <!-- OFFICES -->
    <div class="inspection-area">
      <h3><i class="fa fa-briefcase"></i> Offices / Workspaces</h3>
      <label for="officeNotes">Inspection Notes</label>
      <textarea id="officeNotes" rows="2" placeholder="e.g., Dust on desks, debris under chairs..."></textarea>

      <label for="officePhotos">Upload Photos (max 5)</label>
      <input type="file" id="officePhotos" accept="image/*" multiple>
      <div class="photo-grid" id="officePreview"></div>
    </div>

    <!-- CLASSROOMS -->
    <div class="inspection-area">
      <h3><i class="fa fa-chalkboard-teacher"></i> Classrooms</h3>
      <label for="classroomNotes">Inspection Notes</label>
      <textarea id="classroomNotes" rows="2" placeholder="e.g., Stains on desks, smudges on whiteboard..."></textarea>

      <label for="classroomPhotos">Upload Photos (max 5)</label>
      <input type="file" id="classroomPhotos" accept="image/*" multiple>
      <div class="photo-grid" id="classroomPreview"></div>
    </div>

    <!-- STAIRWELLS -->
    <div class="inspection-area">
      <h3><i class="fa fa-stairs"></i> Stairwells</h3>
      <label for="stairwellNotes">Inspection Notes</label>
      <textarea id="stairwellNotes" rows="2" placeholder="e.g., Dust on rails, debris in corners..."></textarea>

      <label for="stairwellPhotos">Upload Photos (max 5)</label>
      <input type="file" id="stairwellPhotos" accept="image/*" multiple>
      <div class="photo-grid" id="stairwellPreview"></div>
    </div>

    <!-- BATHROOMS -->
    <div class="inspection-area">
      <h3><i class="fa fa-toilet"></i> Bathrooms / Washrooms</h3>
      <label for="bathroomNotes">Inspection Notes</label>
      <textarea id="bathroomNotes" rows="2" placeholder="e.g., Grout discoloration, missing paper towels, odor issues..."></textarea>

      <label for="bathroomPhotos">Upload Photos (max 5)</label>
      <input type="file" id="bathroomPhotos" accept="image/*" multiple>
      <div class="photo-grid" id="bathroomPreview"></div>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev3">Previous</button>
      <button type="button" id="next3">Next</button>
    </div>
  </section>
  <!-- STEP 4 — STANDARD COMMERCIAL CLEANING -->
  <section id="step4">
    <h2><i class="fa fa-broom"></i> Step 4 — Standard Commercial Cleaning</h2>
    <p>Select all applicable cleaning tasks for each section.  
    Unchecked tasks will appear grayed-out in the review summary.</p>

    <!-- GENERAL AREAS / OFFICES -->
    <div class="task-section">
      <h3>General Areas / Offices</h3>
      <div class="task-list">
        <label><input type="checkbox" name="generalTasks" value="Empty all trash bins and replace liners"> Empty all trash bins and replace liners</label>
        <label><input type="checkbox" name="generalTasks" value="Dust desks, furniture, and fixtures"> Dust desks, furniture, and fixtures</label>
        <label><input type="checkbox" name="generalTasks" value="Wipe down high-touch surfaces (door handles, light switches, phones)"> Wipe down high-touch surfaces (door handles, light switches, phones)</label>
        <label><input type="checkbox" name="generalTasks" value="Vacuum carpets and rugs"> Vacuum carpets and rugs</label>
        <label><input type="checkbox" name="generalTasks" value="Sweep and mop hard floors"> Sweep and mop hard floors</label>
        <label><input type="checkbox" name="generalTasks" value="Spot-clean glass, mirrors, and walls"> Spot-clean glass, mirrors, and walls</label>
      </div>
    </div>

    <!-- BATHROOMS -->
    <div class="task-section">
      <h3>Bathrooms / Washrooms</h3>
      <div class="task-list">
        <label><input type="checkbox" name="bathroomTasks" value="Clean and disinfect toilets, sinks, and urinals"> Clean and disinfect toilets, sinks, and urinals</label>
        <label><input type="checkbox" name="bathroomTasks" value="Restock toilet paper, paper towels, and soap dispensers"> Restock toilet paper, paper towels, and soap dispensers</label>
        <label><input type="checkbox" name="bathroomTasks" value="Wipe mirrors and fixtures"> Wipe mirrors and fixtures</label>
        <label><input type="checkbox" name="bathroomTasks" value="Sweep and mop floors with disinfectant"> Sweep and mop floors with disinfectant</label>
        <label><input type="checkbox" name="bathroomTasks" value="Empty and sanitize trash bins"> Empty and sanitize trash bins</label>
      </div>
    </div>

    <!-- KITCHEN -->
    <div class="task-section">
      <h3>Kitchen</h3>
      <div class="task-list">
        <label><input type="checkbox" name="kitchenTasks" value="Clean and disinfect countertops and sinks"> Clean and disinfect countertops and sinks</label>
        <label><input type="checkbox" name="kitchenTasks" value="Wipe exterior of appliances"> Wipe exterior of appliances</label>
        <label><input type="checkbox" name="kitchenTasks" value="Clean microwaves (inside and outside)"> Clean microwaves (inside and outside)</label>
        <label><input type="checkbox" name="kitchenTasks" value="Restock paper towels and soap dispensers"> Restock paper towels and soap dispensers</label>
        <label><input type="checkbox" name="kitchenTasks" value="Sweep and mop kitchen floors"> Sweep and mop kitchen floors</label>
      </div>
    </div>

    <!-- BREAKROOM -->
    <div class="task-section">
      <h3>Breakroom</h3>
      <div class="task-list">
        <label><input type="checkbox" name="breakroomTasks" value="Wipe tables and chairs"> Wipe tables and chairs</label>
        <label><input type="checkbox" name="breakroomTasks" value="Disinfect coffee machine area"> Disinfect coffee machine area</label>
        <label><input type="checkbox" name="breakroomTasks" value="Empty trash and recycling bins"> Empty trash and recycling bins</label>
        <label><input type="checkbox" name="breakroomTasks" value="Vacuum or mop floors"> Vacuum or mop floors</label>
        <label><input type="checkbox" name="breakroomTasks" value="Clean sinks and counters"> Clean sinks and counters</label>
      </div>
    </div>

    <!-- ENTRANCES / HALLWAYS -->
    <div class="task-section">
      <h3>Entrances / Hallways</h3>
      <div class="task-list">
        <label><input type="checkbox" name="entranceTasks" value="Sweep and mop entry floors"> Sweep and mop entry floors</label>
        <label><input type="checkbox" name="entranceTasks" value="Clean entry glass doors"> Clean entry glass doors</label>
        <label><input type="checkbox" name="entranceTasks" value="Wipe wall marks and door frames"> Wipe wall marks and door frames</label>
        <label><input type="checkbox" name="entranceTasks" value="Dust light fixtures and ledges"> Dust light fixtures and ledges</label>
        <label><input type="checkbox" name="entranceTasks" value="Empty entry trash bins"> Empty entry trash bins</label>
      </div>
    </div>

    <!-- STAIRWELLS -->
    <div class="task-section">
      <h3>Stairwells</h3>
      <div class="task-list">
        <label><input type="checkbox" name="stairTasks" value="Sweep and mop stairwell floors"> Sweep and mop stairwell floors</label>
        <label><input type="checkbox" name="stairTasks" value="Wipe and disinfect handrails"> Wipe and disinfect handrails</label>
        <label><input type="checkbox" name="stairTasks" value="Dust light fixtures"> Dust light fixtures</label>
        <label><input type="checkbox" name="stairTasks" value="Clean stairwell windows"> Clean stairwell windows</label>
        <label><input type="checkbox" name="stairTasks" value="Remove cobwebs from corners and ceilings"> Remove cobwebs from corners and ceilings</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev4">Previous</button>
      <button type="button" id="next4">Next</button>
    </div>
  </section>

  <!-- STEP 5 — ADD-ON SERVICES -->
  <section id="step5">
    <h2><i class="fa fa-plus-circle"></i> Step 5 — Add-On Services</h2>
    <p>Select any optional specialty cleaning services for this facility.</p>

    <div class="task-section">
      <h3>Optional Services</h3>
      <div class="task-list">
        <label><input type="checkbox" name="addonTasks" value="Carpet deep cleaning / extraction"> Carpet deep cleaning / extraction</label>
        <label><input type="checkbox" name="addonTasks" value="Window cleaning (interior/exterior)"> Window cleaning (interior/exterior)</label>
        <label><input type="checkbox" name="addonTasks" value="Floor stripping and waxing"> Floor stripping and waxing</label>
        <label><input type="checkbox" name="addonTasks" value="High dusting and vent cleaning"> High dusting and vent cleaning</label>
        <label><input type="checkbox" name="addonTasks" value="Disinfection fogging service"> Disinfection fogging service</label>
        <label><input type="checkbox" name="addonTasks" value="Pressure washing (exterior)"> Pressure washing (exterior)</label>
        <label><input type="checkbox" name="addonTasks" value="Post-construction cleanup"> Post-construction cleanup</label>
      </div>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev5">Previous</button>
      <button type="button" id="next5">Next</button>
    </div>
  </section>

  <!-- STEP 6 — FACILITY COMPOSITION -->
  <section id="step6">
    <h2><i class="fa fa-layer-group"></i> Step 6 — Facility Composition</h2>
    <p>Provide detailed information about the facility’s layout and equipment access.</p>

    <label for="numRestrooms">Number of Restrooms</label>
    <input type="number" id="numRestrooms" min="0" placeholder="e.g., 6">

    <label for="numKitchens">Number of Kitchens / Break Areas</label>
    <input type="number" id="numKitchens" min="0" placeholder="e.g., 2">

    <label for="ceilingType">Ceiling Type</label>
    <select id="ceilingType">
      <option value="">Select type…</option>
      <option>Drop ceiling (tiles)</option>
      <option>Open / Exposed</option>
      <option>Drywall / Solid</option>
      <option>Mixed</option>
    </select>

    <label for="entrances">Number of Entrances</label>
    <input type="number" id="entrances" min="0" placeholder="e.g., 3">

    <label for="cleaningHours">Preferred Cleaning Hours</label>
    <select id="cleaningHours">
      <option value="">Select option…</option>
      <option>During business hours</option>
      <option>After hours / overnight</option>
      <option>Weekend cleaning</option>
    </select>

    <label for="storageSpace">On-site Storage for Supplies</label>
    <select id="storageSpace">
      <option value="">Select option…</option>
      <option>Dedicated janitor closet</option>
      <option>Shared space</option>
      <option>None available</option>
    </select>

    <div class="nav-buttons">
      <button type="button" id="prev6">Previous</button>
      <button type="button" id="next6">Next</button>
    </div>
  </section>
  <!-- STEP 7 — OCCUPANCY & USAGE -->
  <section id="step7">
    <h2><i class="fa fa-users"></i> Step 7 — Occupancy & Usage</h2>
    <p>Provide information about how the facility is used and the average number of occupants during business hours.</p>

    <label for="avgOccupancy">Average Number of Occupants</label>
    <input type="number" id="avgOccupancy" placeholder="e.g., 45">

    <label for="peakHours">Peak Hours / Traffic Periods</label>
    <input type="text" id="peakHours" placeholder="e.g., 11 AM – 2 PM, 4 PM – 6 PM">

    <label for="eventFrequency">Special Events or Meeting Frequency</label>
    <select id="eventFrequency">
      <option value="">Select frequency…</option>
      <option>Daily</option>
      <option>Weekly</option>
      <option>Monthly</option>
      <option>Occasional / Seasonal</option>
      <option>Never</option>
    </select>

    <label for="specialConsiderations">Special Considerations (e.g., pets, high-traffic, sensitive areas)</label>
    <textarea id="specialConsiderations" rows="2" placeholder="e.g., Dog-friendly office, 24-hour staff, etc."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev7">Previous</button>
      <button type="button" id="next7">Next</button>
    </div>
  </section>

  <!-- STEP 8 — CLEANING SCOPE & OPERATIONS -->
  <section id="step8">
    <h2><i class="fa fa-tools"></i> Step 8 — Cleaning Scope & Operations</h2>
    <p>Outline the operational details such as trash handling, supply management, and disinfection responsibilities.</p>

    <label for="trashHandling">Trash & Waste Handling</label>
    <select id="trashHandling">
      <option value="">Select option…</option>
      <option>On-site dumpsters / bins</option>
      <option>Building staff handles removal</option>
      <option>Requires off-site disposal</option>
    </select>

    <label for="consumables">Consumables Provided By</label>
    <select id="consumables">
      <option value="">Select option…</option>
      <option>Client (paper towels, soap, toilet paper)</option>
      <option>Cleaning Company (A TO Z)</option>
      <option>Shared Responsibility</option>
    </select>

    <label for="disinfectionAreas">High-Touch Disinfection Areas</label>
    <textarea id="disinfectionAreas" rows="2" placeholder="e.g., Door handles, elevator buttons, kitchen surfaces"></textarea>

    <label for="onSiteEquipment">On-Site Equipment Availability</label>
    <select id="onSiteEquipment">
      <option value="">Select option…</option>
      <option>Vacuum, mop, and cleaning cart available</option>
      <option>Limited equipment — bring own</option>
      <option>No equipment available on-site</option>
    </select>

    <label for="supplyLocation">Supply Refill / Replenishment Location</label>
    <input type="text" id="supplyLocation" placeholder="e.g., Janitor closet, Room 204, etc.">

    <label for="specialInstructions">Special Instructions or Cleaning Restrictions</label>
    <textarea id="specialInstructions" rows="2" placeholder="e.g., No strong fragrances, eco-products only, etc."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev8">Previous</button>
      <button type="button" id="next8">Next</button>
    </div>
  </section>

  <!-- STEP 9 — COMPLIANCE & SUSTAINABILITY -->
  <section id="step9">
    <h2><i class="fa fa-shield-alt"></i> Step 9 — Compliance & Sustainability</h2>
    <p>Outline any compliance, safety, or environmental requirements for this site.</p>

    <label for="insuranceReq">Insurance Requirements</label>
    <select id="insuranceReq">
      <option value="">Select option…</option>
      <option>Standard Liability (2M)</option>
      <option>High Coverage (5M+)</option>
      <option>WSIB / CNESST Required</option>
      <option>Proof of Insurance Required Before Start</option>
    </select>

    <label for="checkIn">Check-In / Access Control System</label>
    <select id="checkIn">
      <option value="">Select option…</option>
      <option>Manual Sign-In / Logbook</option>
      <option>Key Fob / Card System</option>
      <option>Digital Time Tracking App</option>
      <option>Supervisor Check-In</option>
      <option>None Required</option>
    </select>

    <label for="compliance">Compliance Standards</label>
    <select id="compliance">
      <option value="">Select applicable standards…</option>
      <option>WHMIS / SDS</option>
      <option>Occupational Health & Safety Act (Ontario)</option>
      <option>CNESST (Quebec)</option>
      <option>ISO 14001 / Environmental Management</option>
      <option>LEED / BOMA Certifications</option>
      <option>Other</option>
    </select>

    <label for="ecoFriendly">Eco-Friendly Product Requirement</label>
    <select id="ecoFriendly">
      <option value="">Select option…</option>
      <option>Yes — strictly green-certified</option>
      <option>Preferred but not mandatory</option>
      <option>No preference</option>
    </select>

    <label for="fragranceRestriction">Fragrance or Allergen Restrictions</label>
    <select id="fragranceRestriction">
      <option value="">Select option…</option>
      <option>Fragrance-free only</option>
      <option>Low-scent cleaning products only</option>
      <option>No restrictions</option>
    </select>

    <label for="otherComplianceNotes">Other Compliance Notes</label>
    <textarea id="otherComplianceNotes" rows="2" placeholder="e.g., Require PPE on site, safety orientation needed, etc."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev9">Previous</button>
      <button type="button" id="next9">Next</button>
    </div>
  </section>
  <!-- STEP 7 — OCCUPANCY & USAGE -->
  <section id="step7">
    <h2><i class="fa fa-users"></i> Step 7 — Occupancy & Usage</h2>
    <p>Describe how the facility is used and typical occupancy during normal operations.</p>

    <label for="avgOccupancy">Average Number of Occupants</label>
    <input type="number" id="avgOccupancy" placeholder="e.g., 45">

    <label for="peakHours">Peak Hours / Traffic Periods</label>
    <input type="text" id="peakHours" placeholder="e.g., 11 AM – 2 PM, 4 PM – 6 PM">

    <label for="eventFrequency">Special Events or Meetings Frequency</label>
    <select id="eventFrequency">
      <option value="">Select frequency…</option>
      <option>Daily</option>
      <option>Weekly</option>
      <option>Monthly</option>
      <option>Occasional / Seasonal</option>
      <option>Never</option>
    </select>

    <label for="specialConsiderations">Special Considerations (e.g., high-traffic, sensitive zones)</label>
    <textarea id="specialConsiderations" rows="2" placeholder="e.g., Reception always busy, child care area, etc."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev7">Previous</button>
      <button type="button" id="next7">Next</button>
    </div>
  </section>

  <!-- STEP 8 — CLEANING SCOPE & OPERATIONS -->
  <section id="step8">
    <h2><i class="fa fa-tools"></i> Step 8 — Cleaning Scope & Operations</h2>
    <p>Describe operational details like trash handling, consumables, and disinfection routines.</p>

    <label for="trashHandling">Trash & Waste Handling</label>
    <select id="trashHandling">
      <option value="">Select option…</option>
      <option>On-site dumpsters / bins</option>
      <option>Building staff handles removal</option>
      <option>Requires off-site disposal</option>
    </select>

    <label for="consumables">Consumables Provided By</label>
    <select id="consumables">
      <option value="">Select option…</option>
      <option>Client (paper towels, soap, toilet paper)</option>
      <option>Cleaning Company (A TO Z)</option>
      <option>Shared Responsibility</option>
    </select>

    <label for="disinfectionAreas">High-Touch Disinfection Areas</label>
    <textarea id="disinfectionAreas" rows="2" placeholder="e.g., Door handles, elevator buttons, kitchen surfaces..."></textarea>

    <label for="onSiteEquipment">On-Site Equipment Availability</label>
    <select id="onSiteEquipment">
      <option value="">Select option…</option>
      <option>Vacuum, mop, and cleaning cart available</option>
      <option>Limited equipment — bring own</option>
      <option>No equipment available</option>
    </select>

    <label for="supplyLocation">Supply Refill / Replenishment Location</label>
    <input type="text" id="supplyLocation" placeholder="e.g., Janitor closet in basement, Room 204, etc.">

    <label for="specialInstructions">Special Instructions or Restrictions</label>
    <textarea id="specialInstructions" rows="2" placeholder="e.g., Use eco products only, no bleach in kitchen area..."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev8">Previous</button>
      <button type="button" id="next8">Next</button>
    </div>
  </section>

  <!-- STEP 9 — COMPLIANCE & SUSTAINABILITY -->
  <section id="step9">
    <h2><i class="fa fa-shield-alt"></i> Step 9 — Compliance & Sustainability</h2>
    <p>Outline compliance, safety, and environmental requirements for this site.</p>

    <label for="insuranceReq">Insurance Requirements</label>
    <select id="insuranceReq">
      <option value="">Select option…</option>
      <option>Standard Liability (2M)</option>
      <option>High Coverage (5M+)</option>
      <option>WSIB / CNESST Required</option>
      <option>Proof of Insurance Required Before Start</option>
    </select>

    <label for="checkIn">Check-In / Access Control System</label>
    <select id="checkIn">
      <option value="">Select option…</option>
      <option>Manual Logbook</option>
      <option>Key Fob / Card System</option>
      <option>Digital App Check-In</option>
      <option>Supervisor Verification</option>
      <option>None</option>
    </select>

    <label for="compliance">Compliance Standards</label>
    <select id="compliance">
      <option value="">Select applicable…</option>
      <option>WHMIS / SDS</option>
      <option>Occupational Health & Safety Act (Ontario)</option>
      <option>CNESST (Quebec)</option>
      <option>ISO 14001 / Environmental Management</option>
      <option>LEED / BOMA Certification</option>
    </select>

    <label for="ecoFriendly">Eco-Friendly Product Requirement</label>
    <select id="ecoFriendly">
      <option value="">Select option…</option>
      <option>Yes — green-certified products only</option>
      <option>Preferred but not mandatory</option>
      <option>No preference</option>
    </select>

    <label for="fragranceRestriction">Fragrance or Allergen Restrictions</label>
    <select id="fragranceRestriction">
      <option value="">Select option…</option>
      <option>Fragrance-free only</option>
      <option>Low-scent products only</option>
      <option>No restrictions</option>
    </select>

    <label for="otherComplianceNotes">Other Compliance Notes</label>
    <textarea id="otherComplianceNotes" rows="2" placeholder="e.g., PPE required, safety orientation needed, etc."></textarea>

    <div class="nav-buttons">
      <button type="button" id="prev9">Previous</button>
      <button type="button" id="next9">Next</button>
    </div>
  </section>
  <!-- STEP 10 — DYNAMIC MONTHLY PRICING & CLEANING TIME ESTIMATOR -->
  <section id="step10">
    <h2><i class="fa fa-calculator"></i> Step 10 — Dynamic Monthly Pricing & Cleaning Time Estimator</h2>
    <p>Calculate total cleaning hours, costs, and pricing automatically based on facility data.</p>

    <div class="calc-grid">
      <!-- LEFT: INPUTS -->
      <div class="calc-inputs">
        <label>Cleaning Type</label>
        <select id="cleaningType">
          <option value="standard" selected>Standard (All Tasks)</option>
          <option value="basic">Basic (Light Routine)</option>
          <option value="deep">Deep (Detailed Cleaning)</option>
        </select>

        <label>Crew Size</label>
        <input type="number" id="crewSize" min="1" value="1">

        <label>Travel / Setup Time (hours per job)</label>
        <input type="number" id="setupTime" step="0.1" value="0.5">

        <label>Productivity (sq ft per hour per cleaner)</label>
        <input type="number" id="productivity" step="10" value="333">

        <label>Cleaning Frequency (auto-filled from Step 2)</label>
        <select id="cleanFrequency">
          <option value="1" selected>One-Time Cleaning</option>
          <option value="0.9">Weekly Contract (-10%)</option>
          <option value="0.8">Bi-Weekly Contract (-20%)</option>
          <option value="0.7">Daily Contract (-30%)</option>
        </select>

        <label>Employee Hourly Rate (CAD)</label>
        <input type="number" id="hourlyRate" step="0.01" value="17.60">

        <label>Overhead Cost (%)</label>
        <input type="number" id="overhead" step="0.1" placeholder="e.g., 15">

        <label>Profit Margin (%)</label>
        <input type="number" id="profit" step="0.1" placeholder="e.g., 30">

        <label>Sales Tax (%)</label>
        <input type="number" id="salesTax" step="0.1" placeholder="e.g., 13">

        <h3 style="color:#004AAD;margin-top:20px;">Optional Add-On Services</h3>
        <div id="addonsList" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:6px;">
          <label><input type="checkbox" class="addon" data-rate="0.05"> Carpet Extraction (+ $0.05 /sq ft)</label>
          <label><input type="checkbox" class="addon" data-rate="0.03"> Window Cleaning (+ $0.03 /sq ft)</label>
          <label><input type="checkbox" class="addon" data-rate="0.10"> Floor Strip & Wax (+ $0.10 /sq ft)</label>
          <label><input type="checkbox" class="addon" data-rate="0.02"> High Dusting / Vents (+ $0.02 /sq ft)</label>
          <label><input type="checkbox" class="addon" data-rate="0.04"> Disinfection Fogging (+ $0.04 /sq ft)</label>
        </div>

        <p id="addonsSummary" style="color:#004AAD;font-weight:500;display:none;">
          Add-Ons Selected: <span id="addonCount">0</span> | Extra Rate: $<span id="addonRate">0.00</span> /sq ft
        </p>

        <div class="nav-buttons">
          <button type="button" id="prev10">Previous</button>
          <button type="button" id="calcTime"><i class="fa fa-stopwatch"></i> Calculate</button>
          <button type="button" id="next10">Next</button>
        </div>
      </div>

      <!-- RIGHT: RESULTS -->
      <div class="calc-results">
        <div id="timeResults" style="display:none;">
          <h3><i class="fa fa-clock"></i> Estimated Cleaning Time & Pricing</h3>
          <p><strong>Total Cleaning Hours:</strong> <span id="totalCleaningHours">0</span> hrs</p>
          <p><strong>Per Cleaner:</strong> <span id="perCleanerHours">0</span> hrs</p>
          <p><strong>Labor Cost:</strong> <span id="laborCost">$0.00</span></p>
          <p><strong>Overhead Cost:</strong> <span id="overheadCost">$0.00</span></p>
          <p><strong>Profit Amount:</strong> <span id="profitAmount">$0.00</span></p>
          <p><strong>Total Estimated Cost (Before Tax):</strong> <span id="totalBeforeTax">$0.00</span></p>
          <p><strong>Sales Tax:</strong> <span id="salesTaxAmount">$0.00</span></p>
          <hr>
          <p><strong>Total Estimated Cost (After Tax):</strong> <span id="totalAfterTax">$0.00</span></p>
        </div>

        <p id="ratePerSqFt" style="display:none;background:linear-gradient(90deg,#004AAD,#00C2FF);color:#fff;padding:10px;border-radius:8px;text-align:center;font-weight:600;margin-top:12px;">
          Estimated Rate: <span id="rateValue">$0.00</span> / sq ft — <span id="rateLabel">Standard Cleaning</span>
        </p>

        <div id="summaryCard" style="display:none;background:#F8FAFB;border:1px solid #E5E7EB;border-radius:8px;padding:15px;margin-top:10px;">
          <p><strong>Profit Margin:</strong> <span id="profitMarginValue">0%</span></p>
          <p><strong>Revenue Per Hour:</strong> <span id="revenuePerHour">$0.00 / hr</span></p>
          <p><em style="font-size:0.85rem;color:#6B7280;">Note: If Profit Margin shows red, it’s below 20% — increase hourly rate or reduce overhead for better profitability.</em></p>
        </div>
      </div>
    </div>
  </section>
  <!-- STEP 11 — REVIEW & EXPORT SUMMARY -->
  <section id="step11">
    <h2><i class="fa fa-file-invoice"></i> Step 11 — Review & Export Summary</h2>
    <p>Review the collected data, then export or email a professional summary.</p>

    <div id="summaryContent"
         style="border:1px solid var(--border);border-radius:8px;padding:20px;background:var(--surface);
                max-height:500px;overflow-y:auto;"></div>

    <div class="nav-buttons">
      <button type="button" id="prev11">Previous</button>
      <button type="button" class="secondary-btn" id="downloadPDF">
        <i class="fa fa-download"></i> Download PDF
      </button>
      <button type="button" id="emailGmail"><i class="fa fa-envelope"></i> Email via Gmail</button>
      <button type="button" class="reset-btn" id="resetForm"><i class="fa fa-trash"></i> Reset Form</button>
    </div>
  </section>

</main>

<!-- LIGHTBOX -->
<div id="photoLightbox">
  <button id="lightboxPrev"><i class="fa fa-chevron-left"></i></button>
  <img id="lightboxImg" src="" alt="Inspection Photo">
  <button id="lightboxNext"><i class="fa fa-chevron-right"></i></button>
  <div id="lightboxCaption"></div>
</div>

<!-- FOOTER -->
<footer>
  <p><strong>A TO Z CLEANING EXPERT LTD.</strong><br>
     300 Coventry Road Suite 401, Ottawa ON K1K 4P5<br>
     <a href="mailto:contact@atozcleaningexpert.com">contact@atozcleaningexpert.com</a> | 
     <a href="tel:+16135054688">+1 (613) 505-4688</a><br>
     <a href="https://www.atozcleaningexpert.ca">www.atozcleaningexpert.ca</a></p>
  <p>© 2025 A TO Z Cleaning Expert Ltd. All Rights Reserved.</p>
</footer>

<!-- PDF + LOGIC -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
/* ============================================================
   A TO Z CLEANING EXPERT LTD. — v4.1 FINAL UNIFIED SCRIPT
   ============================================================ */

/* ---------- NAVIGATION ---------- */
let currentStep = 1, totalSteps = 11;
function showStep(step){
  document.querySelectorAll("main section").forEach(s=>s.classList.remove("active"));
  const target=document.getElementById("step"+step);
  if(target)target.classList.add("active");
  document.getElementById("progressBar").style.width=(step/totalSteps*100)+"%";
  document.getElementById("progressText").textContent=`Step ${step} of ${totalSteps}`;
  currentStep=step;
  localStorage.setItem("currentStep",step);
  if(step===11)generateSummary();
}
for(let i=1;i<=totalSteps;i++){
  const n=document.getElementById("next"+i);
  const p=document.getElementById("prev"+i);
  if(n)n.onclick=()=>showStep(i+1);
  if(p)p.onclick=()=>showStep(i-1);
}

/* ---------- DARK MODE ---------- */
document.getElementById("darkToggle").onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode",document.body.classList.contains("dark"));
};

/* ---------- AUTOSAVE ---------- */
function saveForm(){
  const data={};
  document.querySelectorAll("input,textarea,select").forEach(el=>{
    if(!el.id)return;
    if(el.type==="checkbox")data[el.id]=el.checked;
    else if(el.type!=="file")data[el.id]=el.value;
  });
  localStorage.setItem("AtoZData",JSON.stringify(data));
}
function loadForm(){
  const data=JSON.parse(localStorage.getItem("AtoZData")||"{}");
  for(const k in data){
    const el=document.getElementById(k);
    if(!el)continue;
    if(el.type==="checkbox")el.checked=data[k];
    else el.value=data[k];
  }
  if(localStorage.getItem("darkMode")==="true")document.body.classList.add("dark");
  showStep(parseInt(localStorage.getItem("currentStep"))||1);
}

/* ---------- PHOTO UPLOAD (MULTIPLE, MAX 5) ---------- */
const photoStore={};
function previewPhotos(input,previewId){
  const preview=document.getElementById(previewId);
  preview.innerHTML="";
  photoStore[previewId]=[];
  Array.from(input.files).slice(0,5).forEach(file=>{
    const r=new FileReader();
    r.onload=e=>{
      const img=document.createElement("img");
      img.src=e.target.result;
      preview.appendChild(img);
      photoStore[previewId].push(e.target.result);
      saveForm();
    };
    r.readAsDataURL(file);
  });
}
["frontDesk","office","classroom","stairwell","bathroom"].forEach(area=>{
  const input=document.getElementById(area+"Photos");
  if(input)input.onchange=()=>previewPhotos(input,area+"Preview");
});

/* ---------- LIGHTBOX ---------- */
let lbIdx=0,lbList=[];
const lb=document.getElementById("photoLightbox");
const lbImg=document.getElementById("lightboxImg");
const lbCap=document.getElementById("lightboxCaption");
document.querySelectorAll(".photo-grid").forEach(grid=>{
  grid.addEventListener("click",e=>{
    if(e.target.tagName==="IMG"){
      lbList=Array.from(grid.querySelectorAll("img")).map(x=>x.src);
      lbIdx=lbList.indexOf(e.target.src);
      lbImg.src=e.target.src;
      lbCap.textContent=`${grid.id.replace("Preview","")} Photo ${lbIdx+1} of ${lbList.length}`;
      lb.classList.add("active");
    }
  });
});
lb.onclick=e=>{if(e.target.id==="photoLightbox")lb.classList.remove("active");};
document.getElementById("lightboxPrev").onclick=()=>{lbIdx=(lbIdx-1+lbList.length)%lbList.length;lbImg.src=lbList[lbIdx];};
document.getElementById("lightboxNext").onclick=()=>{lbIdx=(lbIdx+1)%lbList.length;lbImg.src=lbList[lbIdx];};

/* ---------- ADD-ON RATE CALC ---------- */
function getAddons(){
  let r=0,c=0;
  document.querySelectorAll(".addon").forEach(a=>{
    if(a.checked){r+=parseFloat(a.dataset.rate);c++;}
  });
  document.getElementById("addonCount").textContent=c;
  document.getElementById("addonRate").textContent=r.toFixed(2);
  document.getElementById("addonsSummary").style.display=c?"block":"none";
  return r;
}
document.querySelectorAll(".addon").forEach(a=>a.onchange=getAddons);

/* ---------- CLEANING FREQUENCY AUTO-SYNC ---------- */
function syncFrequency(){
  const val=document.getElementById("frequency").value;
  const map={Daily:"0.7",Weekly:"0.9","Bi-Weekly":"0.8",Monthly:"1","One-Time":"1"};
  const cleanFreq=document.getElementById("cleanFrequency");
  if(map[val])cleanFreq.value=map[val];
}
document.getElementById("frequency").onchange=syncFrequency;

/* ---------- CALCULATOR ---------- */
document.getElementById("calcTime").onclick=()=>{
  const sqft=parseFloat(document.getElementById("squareFootage").value)||0;
  if(!sqft)return alert("Please enter total square footage in Step 2.");
  const type=document.getElementById("cleaningType").value;
  const crew=+document.getElementById("crewSize").value||1;
  const setup=+document.getElementById("setupTime").value||0.5;
  const prod=+document.getElementById("productivity").value||333;
  const freq=+document.getElementById("cleanFrequency").value||1;
  const rateHr=+document.getElementById("hourlyRate").value||17.6;
  const oh=+document.getElementById("overhead").value||0;
  const pf=+document.getElementById("profit").value||0;
  const tax=+document.getElementById("salesTax").value||0;
  const addon=getAddons();

  let hrs=(sqft/prod)*crew+setup;
  let rateSq=0.30,label="Standard Cleaning";
  if(type==="basic"){hrs*=0.7;rateSq=0.21;label="Basic Cleaning";}
  if(type==="deep"){hrs*=1.3;rateSq=0.39;label="Deep Cleaning";}

  const labor=hrs*rateHr;
  const ohAmt=labor*(oh/100);
  const profitAmt=(labor+ohAmt)*(pf/100);
  let subTotal=labor+ohAmt+profitAmt;
  subTotal*=freq;
  const taxAmt=subTotal*(tax/100);
  const addOns=sqft*addon;
  const total=subTotal+taxAmt+addOns;

  const perCleaner=hrs/crew;
  const margin=(profitAmt/total)*100;
  const revHr=total/hrs;

  document.getElementById("timeResults").style.display="block";
  document.getElementById("totalCleaningHours").textContent=hrs.toFixed(2);
  document.getElementById("perCleanerHours").textContent=perCleaner.toFixed(2);
  document.getElementById("laborCost").textContent=`$${labor.toFixed(2)}`;
  document.getElementById("overheadCost").textContent=`$${ohAmt.toFixed(2)}`;
  document.getElementById("profitAmount").textContent=`$${profitAmt.toFixed(2)}`;
  document.getElementById("totalBeforeTax").textContent=`$${subTotal.toFixed(2)}`;
  document.getElementById("salesTaxAmount").textContent=`$${taxAmt.toFixed(2)}`;
  document.getElementById("totalAfterTax").textContent=`$${total.toFixed(2)}`;
  document.getElementById("ratePerSqFt").style.display="block";
  document.getElementById("rateValue").textContent=`$${rateSq.toFixed(2)}`;
  document.getElementById("rateLabel").textContent=label;
  document.getElementById("summaryCard").style.display="block";
  document.getElementById("profitMarginValue").textContent=`${margin.toFixed(1)}%`;
  document.getElementById("revenuePerHour").textContent=`$${revHr.toFixed(2)} / hr`;
  
  
  

  const pm=document.getElementById("profitMarginValue");
  pm.classList.remove("low-margin","medium-margin","high-margin");
  if(margin<20)pm.classList.add("low-margin");
  else if(margin<30)pm.classList.add("medium-margin");
  else pm.classList.add("high-margin");

  saveForm();
};

/* ---------- REVIEW SUMMARY ---------- */
function generateSummary(){
  const groups={
    "Client Information":["assessorName","clientName","contactPerson","email","phone","address","facilityType","hours"],
    "Facility Overview":["squareFootage","floors","frequency","flooringType","accessNotes"],
    "Inspection Notes":["frontDeskNotes","officeNotes","classroomNotes","stairwellNotes","bathroomNotes"],
    "Estimator":["hourlyRate","overhead","profit","salesTax"]
  };
  let html="";
  for(const g in groups){
    html+=`<h3 style='color:#004AAD;'>${g}</h3>`;
    groups[g].forEach(id=>{
      const el=document.getElementById(id);
      if(el&&el.value)html+=`<p><strong>${id.replace(/([A-Z])/g," $1")}:</strong> ${el.value}</p>`;
    });
  }
  document.getElementById("summaryContent").innerHTML=html;
}

/* ---------- RESET ---------- */
document.getElementById("resetForm").onclick=()=>{
  if(confirm("Reset the entire walkthrough?")){
    localStorage.clear();location.reload();
  }
};

/* ---------- ADD GENERATE QUOTE BUTTON AFTER CALC ---------- */
let pdfBtn = document.getElementById("genQuote");
if (!pdfBtn) {
  pdfBtn = document.createElement("button");
  pdfBtn.id = "genQuote";
  pdfBtn.innerHTML = '<i class="fa fa-file-pdf"></i> Generate Quote PDF';
  document.getElementById("timeResults").appendChild(pdfBtn);

  pdfBtn.addEventListener("click", () => {
    const client = document.getElementById("clientName")?.value || "N/A";
    const addr = document.getElementById("address")?.value || "";
    const total = document.getElementById("totalAfterTax")?.textContent || "$0.00";
    const rate = document.getElementById("rateValue")?.textContent || "$0.00";
    const label = document.getElementById("rateLabel")?.textContent || "Standard Cleaning";

    const quoteHTML = `
      <div style='font-family:Poppins,sans-serif;padding:25px;'>
        <div style='display:flex;justify-content:space-between;align-items:center;'>
          <img src='https://atozcleaningexpert.github.io/assessment/a-to-z-logo.png' style='height:60px;'>
          <div style='text-align:right;font-size:0.9rem;color:#6B7280;'>
            <strong>A TO Z CLEANING EXPERT LTD.</strong><br>
            www.atozcleaningexpert.ca<br>
            contact@atozcleaningexpert.com
          </div>
        </div>
        <hr style='margin:12px 0;border:0;border-top:2px solid #004AAD;'>
        <h2 style='color:#004AAD;'>Cleaning Quote Summary</h2>
        <p><strong>Client / Company:</strong> ${client}</p>
        <p><strong>Address:</strong> ${addr}</p>
        <p><strong>Service Type:</strong> ${label}</p>
        <p><strong>Rate:</strong> ${rate}</p>
        <p><strong>Total Estimated Cost (After Tax):</strong> <span style='color:#004AAD;font-size:1.2rem;'>${total}</span></p>
        <hr>
        <p style='font-size:0.85rem;color:#6B7280;text-align:center;'>© 2025 A TO Z Cleaning Expert Ltd. All Rights Reserved.</p>
      </div>`;
    html2pdf().set({
      margin: 0.5,
      filename: `AtoZ_Cleaning_Quote_${client.replace(/\s+/g,"_")}.pdf`,
      image:{type:"jpeg",quality:0.98},
      html2canvas:{scale:2},
      jsPDF:{unit:"in",format:"letter"}
    }).from(quoteHTML).save();
  });
}


/* ---------- INIT ---------- */
window.onload=loadForm;


/* ============================================================
   PATCH FIX v2: Accurate Frequency Detection + Grouped Summary
   ============================================================ */
(function() {
  const freqOptions = ["Each Visit","Weekly","Monthly","Quarterly","Annually"];

  /* ---------- Create dropdown ---------- */
  function createFrequencySelect(name, idSuffix) {
    const select=document.createElement("select");
    select.className="freqSelect";
    select.dataset.group=name;
    select.innerHTML=`<option value="">Select frequency…</option>`+
      freqOptions.map(o=>`<option>${o}</option>`).join("");
    Object.assign(select.style,{
      marginLeft:"12px",marginTop:"4px",display:"inline-block",width:"180px",
      padding:"6px 8px",fontSize:"0.85rem",border:"1px solid var(--accent)",
      borderRadius:"6px",background:"var(--surface)",color:"var(--text)",
      fontWeight:"400",verticalAlign:"middle",opacity:"0",transform:"translateY(6px)",
      transition:"opacity .4s ease, transform .4s ease"
    });
    return select;
  }

  /* ---------- Attach dropdowns ---------- */
  function handleCheckboxGroup(selector, groupName){
    document.querySelectorAll(selector).forEach((cb,i)=>{
      const freqSelect=createFrequencySelect(groupName,i);
      const wrap=document.createElement("div");
      Object.assign(wrap.style,{display:"flex",alignItems:"center",flexWrap:"wrap",margin:"4px 0"});
      const label=cb.parentElement;
      label.parentElement.insertBefore(wrap,label);
      wrap.appendChild(label);wrap.appendChild(freqSelect);

      // Restore saved value
      const saved=localStorage.getItem(cb.id+"_freqValue");
      if(saved) freqSelect.value=saved;

      function show(defaultIfEmpty=false){
        freqSelect.style.display="inline-block";
        requestAnimationFrame(()=>{freqSelect.style.opacity="1";freqSelect.style.transform="translateY(0)";});
        if(defaultIfEmpty&&!freqSelect.value){
          freqSelect.value="Each Visit";
          localStorage.setItem(cb.id+"_freqValue","Each Visit");
        }
      }
      function hide(){freqSelect.style.opacity="0";freqSelect.style.transform="translateY(6px)";
        setTimeout(()=>freqSelect.style.display="none",300);}
      cb.checked?show():hide();

      cb.addEventListener("change",()=>{
        if(cb.checked)show(true);
        else{hide();freqSelect.value="";localStorage.removeItem(cb.id+"_freqValue");}
        saveForm();
      });
      freqSelect.addEventListener("change",()=>{
        localStorage.setItem(cb.id+"_freqValue",freqSelect.value);
        saveForm();
      });
    });
  }

  [
    ["input[name='generalTasks']","general"],
    ["input[name='bathroomTasks']","bathroom"],
    ["input[name='kitchenTasks']","kitchen"],
    ["input[name='breakroomTasks']","breakroom"],
    ["input[name='entranceTasks']","entrance"],
    ["input[name='stairTasks']","stair"],
    ["input[name='addonTasks']","addon"],
    ["#addonsList .addon","calcAddon"]
  ].forEach(([s,n])=>handleCheckboxGroup(s,n));

  /* ---------- Extend summary generator ---------- */
  const oldGen=window.generateSummary;
  window.generateSummary=function(){
    if(typeof oldGen==="function") oldGen();

    const freqGroups={};
    freqOptions.forEach(f=>freqGroups[f]=[]);
    const allSel="input[name='generalTasks'],input[name='bathroomTasks'],input[name='kitchenTasks'],input[name='breakroomTasks'],input[name='entranceTasks'],input[name='stairTasks'],input[name='addonTasks'],#addonsList .addon";

    document.querySelectorAll(allSel).forEach(cb=>{
      if(cb.checked){
        const wrap=cb.closest("div");
        const select=wrap.querySelector(".freqSelect");
        const freq=(select&&select.value)?select.value:"Each Visit";
        const label=cb.parentElement.textContent.trim();
        freqGroups[freq].push(label);
      }
    });

    const stateKey="freqGroupState";
    const savedState=JSON.parse(localStorage.getItem(stateKey)||"{}");

    let html="<h3 style='color:#004AAD;margin-top:20px;'>Grouped Cleaning Tasks by Frequency</h3>";
    freqOptions.forEach((freq,idx)=>{
      const list=freqGroups[freq]||[];
      const icon=freq==="Each Visit"?"🧹":freq==="Weekly"?"📅":freq==="Monthly"?"🧼":freq==="Quarterly"?"🔄":"📆";
      const blockId=`freqGroup_${idx}`;
      const isOpen=savedState[freq]!==false;
      html+=`
        <div class="freqBlock" style="margin-top:10px;border:1px solid var(--border);border-radius:6px;">
          <div class="freqHeader" data-target="${blockId}" data-freq="${freq}"
               style="background:linear-gradient(90deg,#004AAD,#00C2FF);color:#fff;
                      padding:8px 12px;font-weight:600;cursor:pointer;border-radius:6px 6px 0 0;
                      display:flex;justify-content:space-between;align-items:center;">
            <span>${icon} ${freq} Tasks (${list.length})</span>
            <span class="toggleIcon">${isOpen?"−":"+"}</span>
          </div>
          <div id="${blockId}" class="freqContent"
               style="padding:10px 16px;background:var(--surface);
                      max-height:${isOpen?"800px":"0px"};overflow:hidden;
                      transition:max-height .4s ease,opacity .4s ease;
                      opacity:${isOpen?"1":"0"};">
            ${list.length?list.map(t=>`<p style='margin:4px 0;'>• ${t}</p>`).join(""):
              `<p style='margin:4px 0;color:#6B7280;'><em>No tasks assigned.</em></p>`}
          </div>
        </div>`;
    });

    const sum=document.getElementById("summaryContent");
    if(sum){
      sum.insertAdjacentHTML("beforeend",html);
      sum.querySelectorAll(".freqHeader").forEach(h=>{
        h.addEventListener("click",()=>{
          const target=document.getElementById(h.dataset.target);
          const icon=h.querySelector(".toggleIcon");
          const freq=h.dataset.freq;
          const isOpen=!(target.style.maxHeight==="0px"||target.style.opacity==="0");
          if(isOpen){
            target.style.maxHeight="0px";target.style.opacity="0";icon.textContent="+";
            savedState[freq]=false;
          }else{
            target.style.maxHeight="800px";target.style.opacity="1";icon.textContent="−";
            savedState[freq]=true;
          }
          localStorage.setItem(stateKey,JSON.stringify(savedState));
        });
      });
    }
  };

  const style=document.createElement("style");
  style.textContent=`
    .freqSelect:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,194,255,.25);outline:none;}
    @media(max-width:768px){.freqSelect{display:block!important;width:60%!important;margin-left:32px!important;margin-top:4px!important;}}
    .freqHeader:hover{opacity:0.9;}
  `;
  document.head.appendChild(style);
})();



</script>
</body>
</html>
