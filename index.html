<!-- ============================================================
 A TO Z Cleaning Expert Ltd. — Walkthrough & Internal Assessment Tool (Pro Version)
 Flat Progress Bar | Lighter Gradient | New Pro Sections | Unified Layout
=============================================================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A TO Z Cleaning Expert Ltd. — Walkthrough Tool</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
/* ---------- Global Font ---------- */
body,button,input,textarea,select,h1,h2,h3,h4,h5,h6{
  font-family:'Poppins',sans-serif!important;
}

/* ---------- Theme Colors ---------- */
:root{
  --primary:#0056D2;
  --accent:#00C2FF;
  --background:#F9FAFB;
  --surface:#FFFFFF;
  --text:#1E1E1E;
  --border:#e5e7eb;
}
body.dark{
  --background:#1E1E2F;
  --surface:#2B2B3C;
  --text:#F3F4F6;
  --border:#3E3E50;
}

/* ---------- Header ---------- */
header{
  display:flex;align-items:center;justify-content:space-between;
  background:linear-gradient(90deg,#0056D2 0%,#00C2FF 100%);
  color:#fff;padding:15px 25px;margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
header img{height:60px;margin-right:15px;}
.header-text h1{margin:0;font-size:1.2rem;}
.header-text p{margin:0;font-size:.9rem;color:rgba(255,255,255,.85);}
#darkToggle{background:none;border:none;color:#fff;font-size:1.3rem;cursor:pointer;}
body.dark header{background:linear-gradient(90deg,#0045A0 0%,#0095E5 100%);}

/* ---------- Flat, Light Progress Bar ---------- */
#progressWrapper{
  width:100%;
  background:transparent;
  padding:0;
  margin:20px 0 30px;
}
#progressContainer{
  max-width:900px;margin:0 auto;height:8px;
  border-radius:5px;background:#e5e7eb;
  overflow:hidden;
}
#progressBar{
  height:100%;border-radius:5px;
  background:linear-gradient(90deg,#0056D2 0%,#00C2FF 100%);
  transition:width .3s ease;
}
#progressText{
  max-width:900px;margin:6px auto 0;text-align:right;
  font-size:.85rem;color:var(--text);font-weight:500;opacity:.8;
}

/* ---------- Main Container ---------- */
main{
  max-width:900px;margin:20px auto 60px;background:var(--surface);
  border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.05);padding:25px 30px;
}

/* ---------- Section Headers ---------- */
section h2{
  background:linear-gradient(90deg,#0056D2 0%,#00C2FF 100%);
  color:#fff;padding:10px 15px;border-radius:6px;
  font-weight:600;margin-bottom:15px;
  display:flex;align-items:center;gap:8px;
}
section h2 i{color:#fff;}

/* ---------- Inputs ---------- */
input,textarea,select{
  width:100%;padding:8px;border:1px solid var(--border);
  border-radius:6px;background:var(--background);color:var(--text);
}
textarea{resize:vertical;}
label{display:block;margin:10px 0 4px;font-weight:500;}

/* ---------- Buttons ---------- */
button{
  background:linear-gradient(90deg,#0056D2 0%,#00C2FF 100%);
  color:#fff;border:none;border-radius:6px;
  padding:10px 18px;font-size:.95rem;font-weight:500;
  cursor:pointer;transition:all .3s ease;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
button:hover{
  background:linear-gradient(90deg,#0043A5 0%,#009FE0 100%);
}
.nav-buttons{display:flex;justify-content:space-between;margin-top:30px;margin-bottom:40px;}
#calcEstimate,#clearSignature{font-size:.85rem;padding:7px 14px;border-radius:4px;}

/* ---------- Grid Layouts (Flooring + Add-ons) ---------- */
.addon-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:12px;margin-top:10px;
}
.addon-item{
  display:flex;align-items:center;gap:8px;
  background:var(--background);border:1px solid var(--border);
  border-radius:6px;padding:8px 12px;
}
.addon-item input{transform:scale(1.1);}
.addon-item label{margin:0;font-weight:500;color:var(--text);}

/* ---------- Misc Elements ---------- */
section{display:none;}section.active{display:block;}
#successMessage{display:none;background:#22c55e;color:#fff;padding:10px;border-radius:8px;text-align:center;margin-bottom:15px;}
#signaturePad{width:100%;height:200px;border:1px solid var(--border);border-radius:6px;background:#fff;}
.dark #signaturePad{background:#2B2B3C;}
footer{text-align:center;font-size:.85rem;color:#fff;background:linear-gradient(90deg,#0056D2 0%,#00C2FF 100%);padding:15px 0;}
body.dark footer{background:linear-gradient(90deg,#0045A0 0%,#0095E5 100%);}
</style>
</head>

<body>
<header>
  <button id="darkToggle"><i class="fa fa-moon"></i></button>
  <div class="header-content">
    <img src="images/a-to-z-logo.png" alt="A TO Z Cleaning Expert Logo">
    <div class="header-text">
      <h1>A TO Z CLEANING EXPERT LTD.</h1>
      <p>Comprehensive Walkthrough & Internal Assessment Tool</p>
    </div>
  </div>
</header>

<!-- Flat Progress Bar -->
<div id="progressWrapper">
  <div id="progressContainer"><div id="progressBar"></div></div>
  <div id="progressText">Step 1 of 9</div>
</div>

<main>
  <div id="successMessage">✅ Walkthrough saved successfully! Thank you for completing the A TO Z Cleaning Expert assessment.</div>

  <form id="walkthroughForm">
  <!-- STEP 1: CLIENT INFO -->
  <section id="step1" class="active">
    <h2><i class="fa fa-user-tie"></i> Client & Site Information</h2>

    <label for="clientName">Client / Company Name</label>
    <input type="text" id="clientName" name="clientName" required>

    <label for="contactPerson">Contact Person</label>
    <input type="text" id="contactPerson" name="contactPerson">

    <label for="email">Email</label>
    <input type="email" id="email" name="email">

    <label for="phone">Phone</label>
    <input type="text" id="phone" name="phone">

    <label for="address">Site Address</label>
    <textarea id="address" name="address"></textarea>

    <label for="facilityType">Type of Facility</label>
    <select id="facilityType" name="facilityType">
      <option value="">Select</option>
      <option>Office</option><option>Retail</option><option>Medical</option>
      <option>Industrial</option><option>School</option><option>Condominium</option>
    </select>

    <label for="hours">Hours of Operation</label>
    <input type="text" id="hours" name="hours">

    <div class="nav-buttons">
      <span></span>
      <button type="button" id="next1">Next</button>
    </div>
  </section>
  <!-- ============================================================
   STEP 2: FACILITY OVERVIEW
  ===============================================================-->
  <section id="step2">
    <h2><i class="fa fa-building"></i> Facility Overview</h2>

    <label for="squareFootage">Total Square Footage</label>
    <input type="number" id="squareFootage" name="squareFootage" placeholder="e.g. 10000" required>

    <label for="floors">Number of Floors</label>
    <input type="number" id="floors" name="floors">

    <label>Flooring Types</label>
    <div class="addon-grid" id="flooringGrid">
      <div class="addon-item"><input type="checkbox" name="flooring" value="Tile"><label>Tile</label></div>
      <div class="addon-item"><input type="checkbox" name="flooring" value="Carpet"><label>Carpet</label></div>
      <div class="addon-item"><input type="checkbox" name="flooring" value="Vinyl"><label>Vinyl</label></div>
      <div class="addon-item"><input type="checkbox" name="flooring" value="Hardwood"><label>Hardwood</label></div>
      <div class="addon-item"><input type="checkbox" name="flooring" value="Concrete"><label>Concrete</label></div>
      <div class="addon-item"><input type="checkbox" name="flooring" value="Other"><label>Other</label></div>
    </div>

    <label for="frequency">Cleaning Frequency</label>
    <select id="frequency" name="frequency">
      <option value="">Select</option>
      <option>Weekly (1×/week)</option>
      <option>Twice a week</option>
      <option>Three times a week</option>
      <option>Five times a week</option>
      <option>Daily</option>
    </select>

    <label for="provider">Current Cleaning Provider</label>
    <input type="text" id="provider" name="provider">

    <label for="painPoints">Main Pain Points / Concerns</label>
    <textarea id="painPoints" name="painPoints"></textarea>

    <label for="startDate">Preferred Start Date</label>
    <input type="date" id="startDate" name="startDate">

    <div class="nav-buttons">
      <button type="button" id="prev2">Previous</button>
      <button type="button" id="next2">Next</button>
    </div>
  </section>

  <!-- ============================================================
   STEP 3: AREA-BY-AREA INSPECTION
  ===============================================================-->
  <section id="step3">
    <h2><i class="fa fa-clipboard-check"></i> Area-by-Area Inspection</h2>

    <label>Offices / Work Areas</label>
    <textarea name="officeNotes" placeholder="Condition, special requests…"></textarea>
    <label>Upload Photo(s)</label>
    <input type="file" accept="image/*" id="officePhotos" multiple>

    <label>Restrooms</label>
    <textarea name="restroomNotes" placeholder="Fixtures, odor, consumables…"></textarea>
    <label>Upload Photo(s)</label>
    <input type="file" accept="image/*" id="restroomPhotos" multiple>

    <label>Break Room / Kitchen</label>
    <textarea name="kitchenNotes" placeholder="Appliances, floor type…"></textarea>
    <label>Upload Photo(s)</label>
    <input type="file" accept="image/*" id="kitchenPhotos" multiple>

    <label>Windows & Glass</label>
    <textarea name="windowNotes" placeholder="Inside/Outside cleaning, frequency…"></textarea>
    <label>Upload Photo(s)</label>
    <input type="file" accept="image/*" id="windowPhotos" multiple>

    <label>Floors & Carpets</label>
    <textarea name="floorNotes" placeholder="Type, finish, deep-cleaning needs…"></textarea>
    <label>Upload Photo(s)</label>
    <input type="file" accept="image/*" id="floorPhotos" multiple>

    <div class="nav-buttons">
      <button type="button" id="prev3">Previous</button>
      <button type="button" id="next3">Next</button>
    </div>
  </section>
  <!-- ============================================================
   STEP 4: SPECIALTY & ADD-ON SERVICES
  ===============================================================-->
  <section id="step4">
    <h2><i class="fa fa-plus-circle"></i> Specialty & Add-On Services</h2>
    <p>Select any additional services your client might require:</p>

    <div class="addon-grid">
      <div class="addon-item"><input type="checkbox" name="addons" value="Post-Construction Cleaning"><label>Post-Construction Cleaning</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Floor Strip & Wax"><label>Floor Strip & Wax</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Carpet Extraction"><label>Carpet Extraction</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="High Dusting / Vents"><label>High Dusting / Vents</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Pressure Washing"><label>Pressure Washing</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Window Washing"><label>Window Washing</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Disinfection / Electrostatic Spraying"><label>Disinfection / Electrostatic Spraying</label></div>
      <div class="addon-item"><input type="checkbox" name="addons" value="Supply Restocking"><label>Supply Restocking</label></div>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev4">Previous</button>
      <button type="button" id="next4">Next</button>
    </div>
  </section>

  <!-- ============================================================
   STEP 5: FACILITY COMPOSITION
  ===============================================================-->
  <section id="step5">
    <h2><i class="fa fa-building-columns"></i> Facility Composition</h2>
    <p>Provide an overview of key facility characteristics for accurate service estimation.</p>

    <label for="numRestrooms">Number of Restrooms</label>
    <input type="number" id="numRestrooms" name="numRestrooms" placeholder="e.g. 6">

    <label for="numKitchens">Number of Kitchens / Break Areas</label>
    <input type="number" id="numKitchens" name="numKitchens" placeholder="e.g. 2">

    <label for="ceilingType">Type of Ceiling</label>
    <select id="ceilingType" name="ceilingType">
      <option value="">Select</option>
      <option>Drop Tile</option>
      <option>Drywall</option>
      <option>Open Industrial</option>
      <option>Other</option>
    </select>

    <label for="entrances">Number of Entrances / High-Traffic Areas</label>
    <input type="number" id="entrances" name="entrances" placeholder="e.g. 3">

    <label for="cleaningHours">Allowed Cleaning Hours</label>
    <select id="cleaningHours" name="cleaningHours">
      <option value="">Select</option>
      <option>Daytime</option>
      <option>Evening</option>
      <option>Nighttime</option>
      <option>Flexible</option>
    </select>

    <div class="nav-buttons">
      <button type="button" id="prev5">Previous</button>
      <button type="button" id="next5">Next</button>
    </div>
  </section>
  <!-- ============================================================
   STEP 6: OCCUPANCY & USAGE
  ===============================================================-->
  <section id="step6">
    <h2><i class="fa fa-users"></i> Occupancy & Usage</h2>
    <p>Details about how frequently and heavily the facility is used.</p>

    <label for="avgOccupancy">Average Daily Occupancy</label>
    <input type="number" id="avgOccupancy" name="avgOccupancy" placeholder="e.g. 50 employees / visitors">

    <label for="peakHours">Peak Usage Hours</label>
    <input type="text" id="peakHours" name="peakHours" placeholder="e.g. 9 AM – 5 PM">

    <label for="eventFrequency">Special Event Frequency</label>
    <select id="eventFrequency" name="eventFrequency">
      <option value="">Select</option>
      <option>Rarely (less than once a month)</option>
      <option>Monthly</option>
      <option>Weekly</option>
      <option>Daily</option>
    </select>

    <div class="nav-buttons">
      <button type="button" id="prev6">Previous</button>
      <button type="button" id="next6">Next</button>
    </div>
  </section>

  <!-- ============================================================
   STEP 7: CLEANING SCOPE & OPERATIONAL DETAILS
  ===============================================================-->
  <section id="step7">
    <h2><i class="fa fa-broom"></i> Cleaning Scope & Operational Details</h2>
    <p>Specify what’s included in the cleaning scope and any on-site operational requirements.</p>

    <label for="trashHandling">Trash Removal Responsibility</label>
    <select id="trashHandling" name="trashHandling">
      <option value="">Select</option>
      <option>Client handles waste disposal</option>
      <option>Cleaning team removes all trash</option>
      <option>Shared responsibility</option>
    </select>

    <label for="consumables">Restroom Consumables Supply</label>
    <select id="consumables" name="consumables">
      <option value="">Select</option>
      <option>Client-supplied</option>
      <option>Cleaning contractor-supplied</option>
    </select>

    <label for="disinfectionAreas">Disinfection Focus Areas</label>
    <textarea id="disinfectionAreas" name="disinfectionAreas" placeholder="e.g. Light switches, doorknobs, desks, phones"></textarea>

    <label for="onSiteEquipment">On-Site Cleaning Equipment Available</label>
    <textarea id="onSiteEquipment" name="onSiteEquipment" placeholder="e.g. Vacuums, mop buckets, auto scrubber, etc."></textarea>

    <label for="storageSpace">Storage Space Available for Supplies</label>
    <select id="storageSpace" name="storageSpace">
      <option value="">Select</option>
      <option>Yes</option>
      <option>No</option>
      <option>Limited</option>
    </select>

    <label for="waterAccess">Water Source / Drain Availability</label>
    <select id="waterAccess" name="waterAccess">
      <option value="">Select</option>
      <option>Readily available</option>
      <option>Limited access</option>
      <option>No on-site access</option>
    </select>

    <div class="nav-buttons">
      <button type="button" id="prev7">Previous</button>
      <button type="button" id="next7">Next</button>
    </div>
  </section>
  <!-- ============================================================
   STEP 8: COMPLIANCE & SUSTAINABILITY
  ===============================================================-->
  <section id="step8">
    <h2><i class="fa fa-clipboard-list"></i> Compliance & Sustainability</h2>
    <p>Specify required certifications, supervision methods, and environmental preferences.</p>

    <label for="insuranceReq">Insurance Requirements</label>
    <select id="insuranceReq" name="insuranceReq">
      <option value="">Select</option>
      <option>WSIB Certificate Required</option>
      <option>General Liability Insurance Required</option>
      <option>Both</option>
      <option>Not Required</option>
    </select>

    <label for="checkIn">Preferred Supervision / Check-in Method</label>
    <select id="checkIn" name="checkIn">
      <option value="">Select</option>
      <option>Sign-in Sheet</option>
      <option>Photo Proof via App</option>
      <option>Verbal Confirmation</option>
    </select>

    <label for="compliance">Compliance Standards</label>
    <select id="compliance" name="compliance">
      <option value="">Select</option>
      <option>ISO 9001</option>
      <option>GMP / Food Safety</option>
      <option>LEED Certification</option>
      <option>Other</option>
    </select>

    <label for="ecoFriendly">Use of Eco-Friendly Cleaning Products?</label>
    <select id="ecoFriendly" name="ecoFriendly">
      <option value="">Select</option>
      <option>Yes, mandatory</option>
      <option>Preferred if available</option>
      <option>No preference</option>
    </select>

    <label for="fragranceRestriction">Fragrance / Chemical Restrictions</label>
    <select id="fragranceRestriction" name="fragranceRestriction">
      <option value="">Select</option>
      <option>Fragrance-Free Only</option>
      <option>Low-VOC</option>
      <option>No Restrictions</option>
    </select>

    <div class="nav-buttons">
      <button type="button" id="prev8">Previous</button>
      <button type="button" id="next8">Next</button>
    </div>
  </section>

  <!-- ============================================================
   STEP 9: DYNAMIC MONTHLY PRICING ESTIMATOR
  ===============================================================-->
  <section id="step9">
    <h2><i class="fa fa-calculator"></i> Dynamic Monthly Pricing Estimator</h2>
    <p>Adjust the fields below to calculate your estimated monthly cost.</p>

    <label for="estSquareFootage">Total Square Footage</label>
    <input type="number" id="estSquareFootage" placeholder="e.g. 10000">

    <label for="estFrequency">Cleanings per Week</label>
    <input type="number" id="estFrequency" placeholder="e.g. 5">

    <label for="baseRate">Base Rate per 1,000 sq.ft. ($)</label>
    <input type="number" id="baseRate" value="45">

    <label for="overhead">Overhead %</label>
    <input type="number" id="overhead" value="15">

    <label for="profit">Profit Margin %</label>
    <input type="number" id="profit" value="25" style="margin-bottom:15px;">

    <button type="button" id="calcEstimate"><i class="fa fa-calculator"></i> Calculate Estimate</button>

    <div id="estimateResult" style="margin-top:15px;padding:10px;border:1px solid var(--border);border-radius:6px;background:var(--background);display:none;">
      <p><strong>Base Monthly Cost:</strong> $<span id="baseCost"></span></p>
      <p><strong>Overhead Amount:</strong> $<span id="overheadAmt"></span></p>
      <p><strong>Profit Amount:</strong> $<span id="profitAmt"></span></p>
      <p><strong style="color:var(--primary);font-size:1.1rem;">Final Estimated Monthly Price:</strong> $<span id="finalPrice"></span></p>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev9">Previous</button>
      <button type="button" id="next9">Next</button>
    </div>
  </section>
  <!-- ============================================================
   STEP 10: SIGNATURE & SUMMARY
  ===============================================================-->
  <section id="step10">
    <h2><i class="fa fa-pen-nib"></i> Signature & Submission</h2>
    <p>Sign below to confirm walkthrough completion and submit the assessment.</p>

    <canvas id="signaturePad"></canvas>
    <div style="margin-top:10px;">
      <button type="button" id="clearSignature"><i class="fa fa-eraser"></i> Clear Signature</button>
    </div>

    <div class="nav-buttons">
      <button type="button" id="prev10">Previous</button>
      <button type="submit" id="submitForm"><i class="fa fa-paper-plane"></i> Submit</button>
    </div>
  </section>

  </form>
  <footer>© 2025 A TO Z Cleaning Expert Ltd. All rights reserved.</footer>
</main>

<!-- ============================================================
   INLINE JAVASCRIPT LOGIC
=============================================================== -->
<script>
// ---------- Dark Mode Toggle ----------
const darkToggle=document.getElementById("darkToggle");
darkToggle.addEventListener("click",()=>{document.body.classList.toggle("dark");saveToLocalStorage();});

// ---------- Wizard Navigation ----------
const totalSteps=10;
let currentStep=1;
function showStep(step){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(`step${step}`).classList.add("active");
  document.getElementById("progressBar").style.width=(step/totalSteps)*100+"%";
  document.getElementById("progressText").textContent=`Step ${step} of ${totalSteps}`;
  currentStep=step;saveToLocalStorage();
}
for(let i=1;i<=totalSteps;i++){
  const next=document.getElementById(`next${i}`);
  const prev=document.getElementById(`prev${i}`);
  if(next)next.addEventListener("click",()=>showStep(i+1));
  if(prev)prev.addEventListener("click",()=>showStep(i-1));
}

// ---------- Signature Pad ----------
const canvas = document.getElementById("signaturePad");
const ctx = canvas.getContext("2d");
let drawing = false;
let lastX = 0;
let lastY = 0;

// Responsive canvas setup
function resizeCanvas() {
  const dataURL = canvas.toDataURL(); // keep current signature
  const img = new Image();
  img.src = dataURL;

  const ratio = Math.max(window.devicePixelRatio || 1, 1);
  canvas.width = canvas.offsetWidth * ratio;
  canvas.height = 200 * ratio; // fixed height, scalable width
  ctx.scale(ratio, ratio);
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";

  img.onload = () => ctx.drawImage(img, 0, 0);
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Drawing functions
function startDraw(e) {
  drawing = true;
  const rect = canvas.getBoundingClientRect();
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
  lastX = x;
  lastY = y;
  e.preventDefault();
}

function draw(e) {
  if (!drawing) return;
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
  ctx.beginPath();
  ctx.moveTo(lastX, lastY);
  ctx.lineTo(x, y);
  ctx.stroke();
  lastX = x;
  lastY = y;
}

function stopDraw(e) {
  drawing = false;
  saveToLocalStorage();
}

// Mouse Events
canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mousemove", draw);
canvas.addEventListener("mouseup", stopDraw);
canvas.addEventListener("mouseleave", stopDraw);

// Touch Events (mobile/tablet)
canvas.addEventListener("touchstart", startDraw, { passive: false });
canvas.addEventListener("touchmove", draw, { passive: false });
canvas.addEventListener("touchend", stopDraw);

// Clear button
document.getElementById("clearSignature").onclick = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  saveToLocalStorage();
};

document.getElementById("clearSignature").onclick=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);saveToLocalStorage();};

// ---------- Dynamic Pricing Estimator ----------
document.getElementById("calcEstimate").addEventListener("click",()=>{
  const sqft=parseFloat(document.getElementById("estSquareFootage").value)||0;
  const freq=parseFloat(document.getElementById("estFrequency").value)||0;
  const rate=parseFloat(document.getElementById("baseRate").value)||0;
  const overhead=parseFloat(document.getElementById("overhead").value)||0;
  const profit=parseFloat(document.getElementById("profit").value)||0;
  const base=(sqft/1000)*rate*(freq*4);
  const overheadAmt=base*(overhead/100);
  const profitAmt=(base+overheadAmt)*(profit/100);
  const finalPrice=base+overheadAmt+profitAmt;
  document.getElementById("baseCost").textContent=base.toFixed(2);
  document.getElementById("overheadAmt").textContent=overheadAmt.toFixed(2);
  document.getElementById("profitAmt").textContent=profitAmt.toFixed(2);
  document.getElementById("finalPrice").textContent=finalPrice.toFixed(2);
  document.getElementById("estimateResult").style.display="block";
  saveToLocalStorage();
});

// ---------- LocalStorage Save ----------
function saveToLocalStorage(){
  const form=document.getElementById("walkthroughForm");
  const data=new FormData(form);
  let obj={};data.forEach((v,k)=>obj[k]=v);
  obj.signature=canvas.toDataURL();
  obj.darkMode=document.body.classList.contains("dark");
  obj.step=currentStep;
  localStorage.setItem("walkthroughData",JSON.stringify(obj));
}

// ---------- LocalStorage Load ----------
function loadFromLocalStorage(){
  const saved=localStorage.getItem("walkthroughData");
  if(!saved)return;
  const obj=JSON.parse(saved);
  const form=document.getElementById("walkthroughForm");
  for(const key in obj){if(form.elements[key])form.elements[key].value=obj[key];}
  if(obj.signature){const img=new Image();img.onload=()=>ctx.drawImage(img,0,0);img.src=obj.signature;}
  if(obj.darkMode)document.body.classList.add("dark");
  if(obj.step)showStep(obj.step);
}
window.addEventListener("load",loadFromLocalStorage);

// ---------- Form Submit ----------
document.getElementById("walkthroughForm").addEventListener("submit",function(e){
  e.preventDefault();saveToLocalStorage();
  const msg=document.getElementById("successMessage");
  msg.style.display="block";msg.style.opacity="1";
  setTimeout(()=>{msg.style.opacity="0";},3000);
  setTimeout(()=>{msg.style.display="none";},4000);
});

// ---------- Reset Button ----------
document.getElementById("walkthroughForm").insertAdjacentHTML("beforeend",
  '<div class="nav-buttons"><button type="button" id="resetForm"><i class="fa fa-trash"></i> Reset Form</button></div>'
);
document.addEventListener("click",function(e){
  if(e.target&&e.target.id==="resetForm"){
    if(!confirm("Are you sure you want to reset the form?"))return;
    localStorage.removeItem("walkthroughData");
    document.getElementById("walkthroughForm").reset();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    document.getElementById("estimateResult").style.display="none";
    document.body.classList.remove("dark");
    showStep(1);
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
</body>
</html>
